!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.SpeedTest=e()}}(function(){return function e(t,n,r){function i(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[o]={exports:{}};t[o][0].call(c.exports,function(e){var n=t[o][1][e];return i(n?n:e)},c,c.exports,e,t,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,t){"use strict";var n=function(e){return e&&e.__esModule?e["default"]:e},r=function(){function e(e,t){for(var n in t){var r=t[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(e,t)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=n(e("./EventDispatcher")),o=n(e("./Http/HttpModule")),u=n(e("./Http/LatencyModule")),a=n(e("./Http/BandwidthModule")),l=n(e("./Timing")),c=e("../utils/helpers").assign,f=function(){function e(){var t=void 0===arguments[0]?{}:arguments[0];i(this,e),this._modules={},this._setModule("latency",new u(t))._setModule("upload",new a("upload",t))._setModule("download",new a("download",t))}return r(e,{isRequesting:{value:function(){var e=this._modules,t=!1;for(var n in e)e.hasOwnProperty(n)&&(t=t||e[n].isRequesting());return t}},_setModule:{value:function(e,t){var n=this;return t&&(this[e]=this._modules[e]=t.on("_newRequest",function(){return!n.isRequesting()})),this}}},{_exposeInternalClasses:{value:function(){c(window,{EventDispatcher:s,HttpModule:o,LatencyModule:u,BandwidthModule:a,Timing:l})}}}),e}();t.exports=f},{"../utils/helpers":7,"./EventDispatcher":2,"./Http/BandwidthModule":3,"./Http/HttpModule":4,"./Http/LatencyModule":5,"./Timing":6}],2:[function(e,t){"use strict";var n=function(){function e(e,t){for(var n in t){var r=t[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(e,t)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i=function(){function e(){r(this,e),this._events={}}return n(e,{on:{value:function(e,t){var n=this;return e=Array.isArray(e)?e:[e],e.forEach(function(e){var r=n._events[e]=n._events[e]||[];~r.indexOf(t)||r.push(t)}),this}},off:{value:function(e,t){var n=this;return e=Array.isArray(e)?e:[e],e.forEach(function(e){var r=n._events[e];if(void 0==t&&r)delete n._events[e];else{var i=r?r.indexOf(t):-1;~i&&r.splice(i,1)}}),this}},trigger:{value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];var i=this._events[e]||[],s=!0;return i.forEach(function(e){var t=e.apply(void 0,n);t=t!==!1?!0:!1,s=s&&t}),s}}}),e}();t.exports=i},{}],3:[function(e,t){"use strict";var n=function(e){return e&&e.__esModule?e["default"]:e},r=function(){function e(e,t){for(var n in t){var r=t[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(e,t)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function h(e,t,n){var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:h(i,t,n)}if("value"in r&&r.writable)return r.value;var s=r.get;return void 0===s?void 0:s.call(n)},s=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)},o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},u=n(e("./HttpModule")),a=n(e("../Timing")),l=e("../../utils/helpers"),c=l.assign,f=l.defer,d=function(e){function t(e){var n=this,r=void 0===arguments[1]?{}:arguments[1];o(this,t),e=~["upload","download"].indexOf(e)?e:"download",r=c({dataSize:{upload:2097152,download:10485760,multiplier:2}},r),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,r),this._loadingType=e,this._intendedEnd=!1,this._isRestarting=!1,this._lastLoadedValue=null,this._speedRecords=[],this._avgSpeed=null,this._requestID=0,this._progressID=0,this._started=!1,this._firstProgress=!0,this._deferredProgress,this._timingLabels={start:null,progress:null,end:null,measure:null},this.on("xhr-upload-loadstart",function(){return a.mark(n._timingLabels.start)}),this.on("xhr-readystatechange",function(e){n._started||e.readyState!=XMLHttpRequest.LOADING||(a.mark(n._timingLabels.start),n._started=!0)});var s="upload"==e?"xhr-upload":"xhr";this.on(""+s+"-progress",function(e,t){return n._progress(t)}),this.on(""+s+"-timeout",function(){return n._timeout()}),this.on(""+s+"-loadend",function(){return n._end()})}return s(t,e),r(t,{start:{value:function(){var e=this._loadingType,t=this._options.dataSize,n=this._requestID++;this._intendedEnd=!1,this._lastLoadedValue=null,this._speedRecords=[],this._started=!1,this._firstProgress=!0,this._deferredProgress=f(),this._isRestarting||this.trigger("start","upload"==e?t.upload:t.download);var r=this._timingLabels;r.start=""+e+"-"+n+"-start",r.progress=""+e+"-"+n+"-progress",r.end=""+e+"-"+n+"-end",r.measure=""+e+"-"+n+"-measure";var i="upload"==e?new Blob([new ArrayBuffer(t.upload)]):null,s="download"==e?"GET":"POST";this._newRequest(s,{size:t.download})._sendRequest(i)}},abort:{value:function(){return this._intendedEnd=!0,this._abort()}},_progress:{value:function(e){var t=this;if(this._firstProgress)return this._firstProgress=!1;this._deferredProgress.run();var n=this._timingLabels,r=this._progressID++,i=""+n.progress+"-"+r,s=e.loaded;a.mark(i);var o,u=a.measure(""+n.measure+"-avg-"+r,n.start,i),l=s/u*1e3;if(this._lastLoadedValue){var c=a.measure(""+n.measure+"-instant-"+r,""+n.progress+"-"+(r-1),i);o=(s-this._lastLoadedValue)/c*1e3}else o=l;this._lastLoadedValue=s,this._deferredProgress=f(function(){t._avgSpeed=l,t._speedRecords.push(o),t.trigger("progress",l,o)})}},_timeout:{value:function(){this._intendedEnd=!0}},_end:{value:function(){if(this._intendedEnd)this._isRestarting=!1,this.trigger("end",this._avgSpeed,this._speedRecords);else{var e=this._loadingType,t=this._options.dataSize;t.upload*=t.multiplier,t.download*=t.multiplier,this.trigger("restart","upload"==e?t.upload:t.download),this._isRestarting=!0,this.start()}}}}),t}(u);t.exports=d},{"../../utils/helpers":7,"../Timing":6,"./HttpModule":4}],4:[function(e,t){"use strict";var n=function(e){return e&&e.__esModule?e["default"]:e},r=Array.prototype.slice,i=function(){function e(e,t){for(var n in t){var r=t[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(e,t)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function f(e,t,n){var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:f(i,t,n)}if("value"in r&&r.writable)return r.value;var s=r.get;return void 0===s?void 0:s.call(n)},o=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)},u=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},a=n(e("../EventDispatcher")),l=e("../../utils/helpers").assign,c=function(e){function t(e){var n=this,r=void 0===arguments[1]?{}:arguments[1];u(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),r=l({endpoint:"./speedtest.php",delay:8e3},r),this._options=r,this._moduleName=e,this._xhr=null,this._lastURLToken=null,this._requestingOverridden=!1,this._requesting=!1,this.on(["xhr-loadstart","xhr-upload-loadstart"],function(){n._requestingOverridden||(n._requesting=!0)}),this.on(["xhr-loadend","xhr-upload-loadend"],function(){n._requestingOverridden||(n._requesting=!1)})}return o(t,e),i(t,{isRequesting:{value:function(){return this._requesting}},_newRequest:{value:function(e,t){if(!this.trigger("_newRequest")&&!this._requestingOverridden)return console.warn("To ensure accurate measures, you can only make one request at a time."),this;var n=this._options,i=new XMLHttpRequest,s=["GET","POST"];if(!~s.indexOf(e))return console.warn("The HTTP method must be GET or POST."),this;t=t||{};var o=(new Date).getTime();this._lastURLToken="speedtest-"+o;var u=n.endpoint;u+=~u.indexOf("?")?"&":"?",u+="module="+this._moduleName,Object.keys(t).forEach(function(e){var n=encodeURIComponent(t[e]);u+="&"+e+"="+n}),u+="&"+this._lastURLToken,i.open(e,u),i.timeout=n.delay,this._xhr&&this._xhr.readyState==XMLHttpRequest.OPENED&&this._xhr.abort(),this._xhr=i;var a=this,l=["loadstart","progress","abort","error","load","timeout","loadend","readystatechange"];return l.forEach(function(e){i.addEventListener(e,function(){("progress"!=e||a._requesting)&&a.trigger.apply(a,["xhr-"+e,i].concat(r.call(arguments)))}),"readystatechange"!=e&&i.upload.addEventListener(e,function(){a.trigger.apply(a,["xhr-upload-"+e,i].concat(r.call(arguments)))})}),this}},_sendRequest:{value:function(e){return this._xhr&&this._xhr.readyState==XMLHttpRequest.OPENED?this._xhr.send("undefined"!=typeof e?e:null):console.warn("A request must have been created before it can be sent."),this}},_abort:{value:function(){return this._xhr&&this._xhr.abort(),this}},_getTimingEntry:{value:function(e){return setTimeout(function(t){return function(){var n=performance.getEntriesByType("resource").filter(function(e){return~e.name.indexOf(t)});"function"==typeof e&&e(n.length?n[0]:null)}}(this._lastURLToken),0),this}},_setRequesting:{value:function(e){this._requestingOverridden=!0,this._requesting=e}}}),t}(a);t.exports=c},{"../../utils/helpers":7,"../EventDispatcher":2}],5:[function(e,t){"use strict";var n=function(e){return e&&e.__esModule?e["default"]:e},r=function(){function e(e,t){for(var n in t){var r=t[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(e,t)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function f(e,t,n){var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:f(i,t,n)}if("value"in r&&r.writable)return r.value;var s=r.get;return void 0===s?void 0:s.call(n)},s=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)},o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},u=n(e("./HttpModule")),a=n(e("../Timing")),l=e("../../utils/helpers").assign,c=function(e){function t(){var e=this,n=void 0===arguments[0]?{}:arguments[0];o(this,t),n=l({latency:{measures:5,attempts:3}},n,{delay:0}),i(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,"latency",n),this._requestsLeft=0,this._attemptsLeft=0,this._latencies=[],this._requestID=0,this._timingLabels={start:null,end:null,measure:null},a.supportsResourceTiming()?this.on("xhr-load",function(){return e._measure()}):(this.on("xhr-loadstart",function(){return a.mark(e._timingLabels.start)}),this.on("xhr-readystatechange",function(t){return e._measure(t)}))}return s(t,e),r(t,{start:{value:function(){var e=this._options.latency,t=e.measures,n=e.attempts;return this._requestsLeft=t,this._attemptsLeft=n*t,a.supportsResourceTiming()||(this._requestsLeft++,this._attemptsLeft++),this._setRequesting(!0),this._latencies=[],this._nextRequest(),this}},_nextRequest:{value:function(){var e=this,t=void 0===arguments[0]?!1:arguments[0],n=this._requestID++,r=t?this._requestsLeft:this._requestsLeft--;if(this._attemptsLeft--&&(r||t)){var i=this._timingLabels;i.start="latency-"+n+"-start",i.end="latency-"+n+"-end",i.measure="latency-"+n+"-measure",this._newRequest("GET")._sendRequest()}else this._setRequesting(!1),setTimeout(function(){return e._end()},0)}},_measure:{value:function(){var e=this,t=void 0===arguments[0]?null:arguments[0];if(t)if(this._requestsLeft<this._options.latency.measures){if(t.readyState==XMLHttpRequest.HEADERS_RECEIVED){var n=this._timingLabels;a.mark(n.end);var r=a.measure(n.measure,n.start,n.end);r&&this._latencies.push(r),this._abort(),this._nextRequest(!r)}}else this._nextRequest();else this._getTimingEntry(function(t){var n=t.secureConnectionStart?t.secureConnectionStart-t.connectStart:t.connectEnd-t.connectStart;n&&e._latencies.push(n),e._nextRequest(!n)})}},_end:{value:function(){var e=this._latencies,t=e.reduce(function(e,t){return e+t},0)/(e.length||1);if(t=t||null,e.length<this._options.latency.measures){var n=this._options.latency,r=n.measures,i=n.attempts;console.warn(["An insufficient number of measures have been processed, this could be due to your web server using","persistant connections or to your client options (measures: "+r+", attempts: "+i+")"].join(" "))}this.trigger("end",t,e)}}}),t}(u);t.exports=c},{"../../utils/helpers":7,"../Timing":6,"./HttpModule":4}],6:[function(e,t){"use strict";var n=function(){function e(e,t){for(var n in t){var r=t[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(e,t)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i=function(){function e(){r(this,e),this._marks={},this._measures={},this._support={performance:!!window.performance,userTiming:window.performance&&performance.mark,resourceTiming:window.performance&&"function"==typeof performance.getEntriesByType&&performance.timing}}return n(e,{mark:{value:function(e){var t=this._support,n=this._marks;return t.userTiming?performance.mark(e):n[e]=t.performance?performance.now():(new Date).getTime(),this}},measure:{value:function(e,t,n){var r=this._support,i=this._marks,s=this._measures;return"undefined"==typeof s[e]&&(r.userTiming?(performance.measure(e,t,n),s[e]=performance.getEntriesByName(e)[0].duration):s[e]=i[n]-i[t]),s[e]}},supportsResourceTiming:{value:function(){return this._support.resourceTiming}}}),e}();t.exports=new i},{}],7:[function(e,t,n){"use strict";function r(e){return void 0!=e&&null!=e&&"object"==typeof e.valueOf()}function i(){for(var e=arguments.length,t=Array(e>1?e-1:0),n=1;e>n;n++)t[n-1]=arguments[n];var s=void 0===arguments[0]?{}:arguments[0];return t.forEach(function(e){Object.keys(e).forEach(function(t){var n=e[t];s[t]=r(n)?i(s[t],n):n})}),s}function s(){var e=void 0===arguments[0]?function(){}:arguments[0];return new(function(){var t=function(){u(this,t),this.cb=e};return o(t,{run:{value:function(){this.cb&&this.cb(),delete this.cb}}}),t}())}var o=function(){function e(e,t){for(var n in t){var r=t[n];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(e,t)}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};n.isObject=r,n.assign=i,n.defer=s,Object.defineProperty(n,"__esModule",{value:!0})},{}]},{},[1])(1)});
//# sourceMappingURL=speedtest.min.js.map